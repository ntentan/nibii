language: php
php:
 - "5.4"
 - "5.5"
 - "7"
 - "hhvm"

env:
 - NIBII_DRIVER=mysql NIBII_HOST=localhost NIBII_USER=root NIBII_DBNAME=nibii_test NIBII_PDO_DSN='mysql:host=localhost;dbname=nibii_test;user=root'


matrix:
 allow_failures:
  - php: "7"
 include:
  - php: "5.6"
    env: NIBII_DRIVER=mysql NIBII_HOST=localhost NIBII_USER=root NIBII_DBNAME=nibii_test NIBII_PDO_DSN='mysql:host=localhost;dbname=nibii_test;user=root' COVERAGE=yes
  
before_script:
 - composer install --prefer-dist
 - if [ "$NIBII_DRIVER" = "mysql" ]; then mysql -e 'create database nibii_test;'; fi
 - if [ "$NIBII_DRIVER" = "mysql" ]; then mysql nibii_test < tests/databases/mysql.sql; fi

services:
 - mysql

script: vendor/bin/phpunit --coverage-clover coverage.clover --configuration tests/config/travis.xml
after_script: if [ "$COVERAGE" == "yes" ]; then wget https://scrutinizer-ci.com/ocular.phar && php ocular.phar code-coverage:upload --format=php-clover coverage.clover; fi
